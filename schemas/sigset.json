{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "urn:oerc-s:schema:sigset:v0.1",
  "$source": "https://oerc-s.github.io/oerc-s/schemas/sigset.json",
  "title": "OERC-S Signature Set (SigSet)",
  "description": "Schema for multi-signature sets supporting classical, PQC, and hybrid signature verification",
  "version": "1.0.0",

  "type": "object",
  "required": ["signatures"],
  "additionalProperties": false,

  "properties": {
    "signatures": {
      "type": "array",
      "minItems": 1,
      "description": "Ordered array of signatures. For hybrid suites, classical signature MUST come first, followed by PQC signature",
      "items": {
        "$ref": "#/$defs/signature_entry"
      }
    },
    "metadata": {
      "type": "object",
      "description": "Optional metadata about the signature set",
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of signature creation"
        },
        "identity_binding": {
          "type": "string",
          "description": "Identifier binding multiple signatures to the same logical identity"
        },
        "hybrid_suite": {
          "type": "string",
          "pattern": "^hybrid-(sig|kem)-v[0-9]+$",
          "description": "If present, indicates this sigset fulfills a hybrid suite requirement"
        }
      }
    }
  },

  "$defs": {
    "signature_entry": {
      "type": "object",
      "required": ["pubkey", "suite_id", "signature"],
      "additionalProperties": false,
      "properties": {
        "pubkey": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]+$",
          "description": "Hex-encoded public key bytes"
        },
        "suite_id": {
          "type": "string",
          "pattern": "^(ed25519|ml-dsa-65)-v[0-9]+$",
          "description": "Cryptographic suite identifier from the crypto_suites registry"
        },
        "signature": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]+$",
          "description": "Hex-encoded signature bytes"
        },
        "key_id": {
          "type": "string",
          "description": "Optional key identifier for key rotation tracking"
        }
      }
    }
  },

  "validation_rules": {
    "ordering": {
      "description": "Signatures MUST be ordered: classical suites first, then PQC suites",
      "classical_suites": ["ed25519-v1"],
      "pqc_suites": ["ml-dsa-65-v1"],
      "order": ["classical", "pqc"]
    },

    "hybrid_requirements": {
      "hybrid-sig-v1": {
        "required_suites": ["ed25519-v1", "ml-dsa-65-v1"],
        "min_signatures": 2,
        "same_identity": true,
        "description": "For hybrid-sig-v1, sigset MUST contain exactly one Ed25519 signature AND one ML-DSA-65 signature from the same logical identity"
      }
    },

    "pubkey_length_validation": {
      "ed25519-v1": {
        "hex_length": 64,
        "byte_length": 32
      },
      "ml-dsa-65-v1": {
        "hex_length": 3904,
        "byte_length": 1952
      }
    },

    "signature_length_validation": {
      "ed25519-v1": {
        "hex_length": 128,
        "byte_length": 64
      },
      "ml-dsa-65-v1": {
        "hex_length": 6586,
        "byte_length": 3293
      }
    }
  },

  "examples": {
    "single_classical": {
      "description": "Single Ed25519 signature",
      "value": {
        "signatures": [
          {
            "pubkey": "d75a980182b10ab7d54bfed3c964073a0ee172f3daa62325af021a68f707511a",
            "suite_id": "ed25519-v1",
            "signature": "e5564300c360ac729086e2cc806e828a84877f1eb8e5d974d873e065224901555fb8821590a33bacc61e39701cf9b46bd25bf5f0595bbe24655141438e7a100b"
          }
        ]
      }
    },

    "single_pqc": {
      "description": "Single ML-DSA-65 signature",
      "value": {
        "signatures": [
          {
            "pubkey": "<1952 bytes hex-encoded>",
            "suite_id": "ml-dsa-65-v1",
            "signature": "<3293 bytes hex-encoded>"
          }
        ]
      }
    },

    "hybrid_sig_v1": {
      "description": "Hybrid signature set with both Ed25519 and ML-DSA-65 (required for hybrid-sig-v1 suite)",
      "value": {
        "signatures": [
          {
            "pubkey": "d75a980182b10ab7d54bfed3c964073a0ee172f3daa62325af021a68f707511a",
            "suite_id": "ed25519-v1",
            "signature": "e5564300c360ac729086e2cc806e828a84877f1eb8e5d974d873e065224901555fb8821590a33bacc61e39701cf9b46bd25bf5f0595bbe24655141438e7a100b"
          },
          {
            "pubkey": "<1952 bytes hex-encoded ML-DSA-65 public key>",
            "suite_id": "ml-dsa-65-v1",
            "signature": "<3293 bytes hex-encoded ML-DSA-65 signature>"
          }
        ],
        "metadata": {
          "created_at": "2025-01-01T00:00:00Z",
          "identity_binding": "urn:oerc-s:identity:example-entity-001",
          "hybrid_suite": "hybrid-sig-v1"
        }
      }
    }
  },

  "verification_algorithm": {
    "description": "Pseudocode for sigset verification",
    "steps": [
      "1. Parse sigset JSON and validate against this schema",
      "2. If metadata.hybrid_suite is set, verify required suites are present",
      "3. Verify signature ordering (classical before PQC)",
      "4. For each signature entry:",
      "   a. Lookup suite_id in crypto_suites registry",
      "   b. Validate pubkey length matches suite specification",
      "   c. Validate signature length matches suite specification",
      "   d. Verify signature using suite-specific algorithm",
      "5. For hybrid suites, verify all component signatures are from same identity",
      "6. Return success only if ALL signatures verify"
    ],
    "failure_modes": {
      "INVALID_SCHEMA": "Sigset does not conform to JSON schema",
      "UNKNOWN_SUITE": "suite_id not found in registry",
      "INVALID_PUBKEY_LENGTH": "Public key length does not match suite spec",
      "INVALID_SIG_LENGTH": "Signature length does not match suite spec",
      "SIG_VERIFY_FAILED": "Cryptographic signature verification failed",
      "MISSING_HYBRID_COMPONENT": "Hybrid suite missing required signature type",
      "ORDERING_VIOLATION": "Signatures not in required order",
      "IDENTITY_MISMATCH": "Hybrid signatures not from same logical identity"
    }
  }
}
